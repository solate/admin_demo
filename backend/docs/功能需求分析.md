# 功能需求分析

## 需求概述

基于需求文档，系统需要实现以下核心功能模块：

### 1. 登录认证模块
**需求**: 登录页面包含页面名称、账户、密码、查看密码按钮、登录、注册功能

**已实现**: 基于现有的 `sys_user` schema 和认证相关功能

### 2. 工厂管理模块 (页面1)
**需求**: 可新建工厂、搜索、编辑、删除

**对应Schema**: `Factory`

**需要实现的API接口**:
- `POST /api/factory/create` - 创建工厂
- `GET /api/factory/list` - 获取工厂列表（支持搜索）
- `GET /api/factory/detail` - 获取工厂详情
- `PUT /api/factory/update` - 更新工厂
- `DELETE /api/factory/delete` - 删除工厂

### 3. 商品管理模块 (页面2)
**需求**: 可新建商品（商品基础信息及价格）、对商品进行入库、出库、展示剩余库存

**对应Schema**: `Product` + `Inventory`

**需要实现的API接口**:

#### 商品管理
- `POST /api/product/create` - 创建商品
- `GET /api/product/list` - 获取商品列表（支持搜索）
- `GET /api/product/detail` - 获取商品详情
- `PUT /api/product/update` - 更新商品
- `DELETE /api/product/delete` - 删除商品

#### 库存管理
- `POST /api/inventory/in` - 商品入库
- `POST /api/inventory/out` - 商品出库
- `GET /api/inventory/list` - 获取库存记录列表
- `GET /api/inventory/stock` - 获取商品库存信息

### 4. 数据统计模块 (页面3)
**需求**: 商品总额、商品数量，入库出库数量、库存数量等

**对应Schema**: `ProductStatistics`

**需要实现的API接口**:
- `GET /api/statistics/daily` - 获取日统计
- `GET /api/statistics/monthly` - 获取月统计
- `GET /api/statistics/yearly` - 获取年统计
- `POST /api/statistics/calculate` - 计算统计数据

## 技术实现要点

### 1. 数据库操作
- 使用 Ent ORM 进行数据库操作
- 实现事务处理确保数据一致性
- 库存操作需要原子性更新

### 2. 业务逻辑
- 库存操作需要同时更新商品表和库存记录表
- 统计功能需要定时任务或实时计算
- 价格计算使用 decimal 类型确保精度

### 3. 接口设计
- 统一的响应格式
- 分页查询支持
- 搜索和过滤功能
- 参数验证和错误处理

### 4. 权限控制
- 基于现有权限系统
- 租户数据隔离
- 操作日志记录
