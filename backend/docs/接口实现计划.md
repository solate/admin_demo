# 接口实现计划

## 实现优先级

### 第一阶段：工厂管理模块
**目标**: 完成工厂的CRUD操作

**实现步骤**:
1. 生成 Ent 代码
2. 创建 Factory 相关的 handler、logic、repository
3. 实现 API 接口
4. 添加路由配置
5. 测试接口功能

**API 接口清单**:
```
POST   /api/factory/create     - 创建工厂
GET    /api/factory/list       - 工厂列表（支持分页、搜索）
GET    /api/factory/detail     - 工厂详情
PUT    /api/factory/update     - 更新工厂
DELETE /api/factory/delete     - 删除工厂
```

### 第二阶段：商品管理模块
**目标**: 完成商品的基础CRUD操作

**实现步骤**:
1. 生成 Ent 代码
2. 创建 Product 相关的 handler、logic、repository
3. 实现商品管理 API 接口
4. 测试商品管理功能

**API 接口清单**:
```
POST   /api/product/create     - 创建商品
GET    /api/product/list       - 商品列表（支持分页、搜索、筛选）
GET    /api/product/detail     - 商品详情
PUT    /api/product/update     - 更新商品
DELETE /api/product/delete     - 删除商品
```

### 第三阶段：库存管理模块
**目标**: 实现商品的入库、出库操作

**实现步骤**:
1. 生成 Ent 代码
2. 创建 Inventory 相关的 handler、logic、repository
3. 实现库存操作 API 接口
4. 实现库存更新逻辑（原子性操作）
5. 测试库存管理功能

**API 接口清单**:
```
POST   /api/inventory/in       - 商品入库
POST   /api/inventory/out      - 商品出库
GET    /api/inventory/list     - 库存记录列表
GET    /api/inventory/stock    - 商品库存信息
GET    /api/inventory/history  - 库存操作历史
```

### 第四阶段：数据统计模块
**目标**: 实现数据统计和报表功能

**实现步骤**:
1. 生成 Ent 代码
2. 创建 ProductStatistics 相关的 handler、logic、repository
3. 实现统计计算逻辑
4. 实现统计 API 接口
5. 测试统计功能

**API 接口清单**:
```
GET    /api/statistics/daily     - 日统计
GET    /api/statistics/monthly   - 月统计
GET    /api/statistics/yearly    - 年统计
POST   /api/statistics/calculate - 手动计算统计
GET    /api/statistics/overview  - 统计概览
```

## 技术实现细节

### 1. 代码生成
```bash
# 生成 Ent 代码
go run -mod=mod entgo.io/ent/cmd/ent generate --target ./pkg/ent/generated --feature sql/upsert,sql/versioned-migration,sql/modifier ./pkg/ent/schema
```

### 2. 项目结构
```
internal/
├── handler/
│   ├── factory/          # 工厂管理接口
│   ├── product/          # 商品管理接口
│   ├── inventory/        # 库存管理接口
│   └── statistics/       # 统计接口
├── logic/
│   ├── factory/          # 工厂业务逻辑
│   ├── product/          # 商品业务逻辑
│   ├── inventory/        # 库存业务逻辑
│   └── statistics/       # 统计业务逻辑
└── repository/
    ├── factory/          # 工厂数据访问
    ├── product/          # 商品数据访问
    ├── inventory/        # 库存数据访问
    └── statistics/       # 统计数据访问
```

### 3. 关键实现要点

#### 库存操作原子性
- 使用数据库事务确保库存更新和记录插入的原子性
- 实现乐观锁防止并发问题

#### 价格精度处理
- 使用 decimal 类型进行价格计算
- 实现价格格式化显示

#### 统计计算
- 实现实时统计和定时统计两种模式
- 支持按时间范围统计

#### 搜索和过滤
- 实现多字段搜索
- 支持分页查询
- 实现排序功能

## 测试计划

### 单元测试
- 每个 handler、logic、repository 都要有对应的测试
- 测试覆盖率要求 > 80%

### 集成测试
- 测试完整的业务流程
- 测试数据库事务
- 测试并发操作

### API 测试
- 使用 Postman 或类似工具测试所有接口
- 测试各种边界条件
- 测试错误处理
